# cd "C:\Users\user\OneDrive\デスクトップ"
# streamlit run app_test_update.py

# pygwalkerをstreamlitに埋め込み、表示させる。
import streamlit as st
import pandas as pd
import pygwalker as pyg
from sklearn import datasets
from pygwalker.api.streamlit import StreamlitRenderer
import pandas as pd

st.set_page_config(
    page_title='Titanic Data',
    layout='wide'
)
# タイトルを追加
st.title('Titanic Data')

@st.cache_resource
def get_pyg_renderer() -> StreamlitRenderer:
    df = pd.read_csv("C:\\Users\\user\\OneDrive\\デスクトップ\\titanic_train.csv")
    return StreamlitRenderer(df, spec="./gw_config.json", spec_io_mode="rw")

# コピーしたPygwalkerチャートのコードをここに貼り付ける
# vis_spec = """<PASTE_COPIED_CODE_HERE>"""
# vis_spec = r"""{"config":[{"config":{"defaultAggregated":true,"geoms":["auto"],"coordSystem":"generic","limit":-1,"timezoneDisplayOffset":0},"encodings":{"dimensions":[{"fid":"Survived","name":"Survived","basename":"Survived","semanticType":"quantitative","analyticType":"dimension","offset":0},{"fid":"Pclass","name":"Pclass","basename":"Pclass","semanticType":"quantitative","analyticType":"dimension","offset":0},{"fid":"Name","name":"Name","basename":"Name","semanticType":"nominal","analyticType":"dimension","offset":0},{"fid":"Sex","name":"Sex","basename":"Sex","semanticType":"nominal","analyticType":"dimension","offset":0},{"fid":"SibSp","name":"SibSp","basename":"SibSp","semanticType":"quantitative","analyticType":"dimension","offset":0},{"fid":"Parch","name":"Parch","basename":"Parch","semanticType":"quantitative","analyticType":"dimension","offset":0},{"fid":"Ticket","name":"Ticket","basename":"Ticket","semanticType":"nominal","analyticType":"dimension","offset":0},{"fid":"Cabin","name":"Cabin","basename":"Cabin","semanticType":"nominal","analyticType":"dimension","offset":0},{"fid":"Embarked","name":"Embarked","basename":"Embarked","semanticType":"nominal","analyticType":"dimension","offset":0},{"fid":"gw_mea_key_fid","name":"Measure names","analyticType":"dimension","semanticType":"nominal"}],"measures":[{"fid":"PassengerId","name":"PassengerId","basename":"PassengerId","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"fid":"Age","name":"Age","basename":"Age","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"fid":"Fare","name":"Fare","basename":"Fare","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"fid":"gw_count_fid","name":"Row count","analyticType":"measure","semanticType":"quantitative","aggName":"sum","computed":true,"expression":{"op":"one","params":[],"as":"gw_count_fid"}},{"fid":"gw_mea_val_fid","name":"Measure values","analyticType":"measure","semanticType":"quantitative","aggName":"sum"}],"rows":[{"fid":"Age","name":"Age","basename":"Age","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0}],"columns":[{"fid":"Parch","name":"Parch","basename":"Parch","semanticType":"quantitative","analyticType":"dimension","offset":0}],"color":[],"opacity":[],"size":[],"shape":[],"radius":[],"theta":[],"longitude":[],"latitude":[],"geoId":[],"details":[],"filters":[],"text":[]},"layout":{"showActions":false,"showTableSummary":false,"stack":"stack","interactiveScale":false,"zeroScale":true,"size":{"mode":"auto","width":320,"height":200},"format":{},"geoKey":"name","resolve":{"x":false,"y":false,"color":false,"opacity":false,"shape":false,"size":false}},"visId":"gw_hsM1","name":"Chart 1"}],"chart_map":{},"workflow_list":[{"workflow":[{"type":"view","query":[{"op":"aggregate","groupBy":["Parch"],"measures":[{"field":"Age","agg":"sum","asFieldKey":"Age_sum"}]}]}]}],"version":"0.4.9.9"}"""
vis_spec = r"""{"config":[{"config":{"defaultAggregated":true,"geoms":["auto"],"coordSystem":"generic","limit":-1,"timezoneDisplayOffset":0},"encodings":{"dimensions":[{"fid":"Name","name":"Name","basename":"Name","semanticType":"nominal","analyticType":"dimension","offset":0},{"fid":"Sex","name":"Sex","basename":"Sex","semanticType":"nominal","analyticType":"dimension","offset":0},{"fid":"SibSp","name":"SibSp","basename":"SibSp","semanticType":"quantitative","analyticType":"dimension","offset":0},{"fid":"Parch","name":"Parch","basename":"Parch","semanticType":"quantitative","analyticType":"dimension","offset":0},{"fid":"Pclass","name":"Pclass","basename":"Pclass","semanticType":"quantitative","analyticType":"dimension","offset":0},{"fid":"Ticket","name":"Ticket","basename":"Ticket","semanticType":"nominal","analyticType":"dimension","offset":0},{"fid":"Cabin","name":"Cabin","basename":"Cabin","semanticType":"nominal","analyticType":"dimension","offset":0},{"fid":"Embarked","name":"Embarked","basename":"Embarked","semanticType":"nominal","analyticType":"dimension","offset":0},{"fid":"gw_mea_key_fid","name":"Measure names","analyticType":"dimension","semanticType":"nominal"}],"measures":[{"fid":"PassengerId","name":"PassengerId","basename":"PassengerId","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"fid":"Survived","name":"Survived","basename":"Survived","semanticType":"quantitative","analyticType":"measure","offset":0},{"fid":"Age","name":"Age","basename":"Age","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"fid":"Fare","name":"Fare","basename":"Fare","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"fid":"gw_count_fid","name":"Row count","analyticType":"measure","semanticType":"quantitative","aggName":"sum","computed":true,"expression":{"op":"one","params":[],"as":"gw_count_fid"}},{"fid":"gw_mea_val_fid","name":"Measure values","analyticType":"measure","semanticType":"quantitative","aggName":"sum"}],"rows":[{"fid":"Survived","name":"Survived","basename":"Survived","semanticType":"quantitative","analyticType":"measure","offset":0,"aggName":"count"}],"columns":[{"fid":"Pclass","name":"Pclass","basename":"Pclass","semanticType":"quantitative","analyticType":"dimension","offset":0}],"color":[],"opacity":[],"size":[],"shape":[],"radius":[],"theta":[],"longitude":[],"latitude":[],"geoId":[],"details":[],"filters":[],"text":[]},"layout":{"showActions":false,"showTableSummary":false,"stack":"stack","interactiveScale":false,"zeroScale":true,"size":{"mode":"auto","width":254,"height":247},"format":{},"geoKey":"name","resolve":{"x":false,"y":false,"color":false,"opacity":false,"shape":false,"size":false}},"visId":"gw_eLQg","name":"Chart 1"}],"chart_map":{},"workflow_list":[{"workflow":[{"type":"view","query":[{"op":"aggregate","groupBy":["Pclass"],"measures":[{"field":"Survived","agg":"count","asFieldKey":"Survived_count"}]}]}]}],"version":"0.4.9.9"}"""
pyg_app = get_pyg_renderer()

pyg_app.explorer()